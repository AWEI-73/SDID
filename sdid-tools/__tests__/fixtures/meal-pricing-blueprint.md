# ğŸ“‹ ç”¨é¤ç®¡ç†ç³»çµ± - æ´»è—åœ– (Living Blueprint)

**è¿­ä»£**: iter-1  
**æ—¥æœŸ**: 2026-02-12  
**è—åœ–ç‹€æ…‹**: [~] ACTIVE  
**è¦æ¨¡**: M  
**æ–¹æ³•è«–**: SDID v2.1

---

## ç”¨æˆ¶åŸå§‹éœ€æ±‚

> æˆ‘éœ€è¦ä¸€å€‹ç”¨é¤ç®¡ç†ç³»çµ±ï¼Œå¯ä»¥ç®¡ç†å…¬å¸å“¡å·¥çš„ç”¨é¤è¨‚è³¼å’Œè¨ˆåƒ¹ã€‚
> æ¯é€±çš„ä¾›é¤å¤©æ•¸å¯èƒ½ä¸ä¸€æ¨£ï¼Œå–®åƒ¹ä¹Ÿå¯èƒ½èª¿æ•´ï¼Œé¤åˆ¥ä¹Ÿä¸å›ºå®šã€‚
> éœ€è¦èƒ½é ä¼°æœ¬é€±è²»ç”¨çµ¦å» å•†ï¼Œä½†å¯¦éš›ç”¨é¤äººæ•¸å¯èƒ½è·Ÿé ä¼°ä¸åŒã€‚

---

## ä¸€å¥è©±ç›®æ¨™

è®“å…¬å¸èƒ½å½ˆæ€§ç®¡ç†æ¯é€±ç”¨é¤è¨‚è³¼ï¼Œè‡ªå‹•è¨ˆç®—é ä¼°èˆ‡å¯¦éš›è²»ç”¨å·®ç•°ã€‚

---

## ğŸ—ï¸ æ¨¡çµ„åŒ–è¨­è¨ˆè—åœ–

### 1. æ—ç¾¤è­˜åˆ¥

| æ—ç¾¤åç¨± | æè¿° | ç‰¹æ®Šéœ€æ±‚ |
|---------|------|---------|
| è¡Œæ”¿äººå“¡ | è² è²¬è¨­å®šæ¯é€±èœå–®å’Œåƒ¹æ ¼ | å¿«é€Ÿè¨­å®šã€æ‰¹æ¬¡æ“ä½œ |
| å“¡å·¥ | ç™»è¨˜ç”¨é¤æ„é¡˜ | ç°¡å–®å‹¾é¸ |
| è²¡å‹™äººå“¡ | æŸ¥çœ‹è²»ç”¨å ±è¡¨ | é ä¼°vså¯¦éš›å°æ¯” |

### 2. å¯¦é«”å®šç¾© (Entity Tables)

#### Vendor
| æ¬„ä½ | å‹åˆ¥ | ç´„æŸ | èªªæ˜ |
|------|------|------|------|
| id | string | PK, UUID | ä¸»éµ |
| name | string | NOT NULL | å» å•†åç¨± |
| contact | string | NOT NULL | è¯çµ¡æ–¹å¼ |

#### MealPlan
| æ¬„ä½ | å‹åˆ¥ | ç´„æŸ | èªªæ˜ |
|------|------|------|------|
| id | string | PK, UUID | ä¸»éµ |
| weekOf | string | NOT NULL | é€±èµ·å§‹æ—¥ YYYY-MM-DD |
| vendorId | string | FK â†’ Vendor.id | å» å•† |
| status | enum | 'DRAFT'\|'CONFIRMED'\|'SETTLED' | ç‹€æ…‹ |

#### MealItem
| æ¬„ä½ | å‹åˆ¥ | ç´„æŸ | èªªæ˜ |
|------|------|------|------|
| id | string | PK, UUID | ä¸»éµ |
| planId | string | FK â†’ MealPlan.id | æ‰€å±¬è¨ˆç•« |
| date | string | NOT NULL | æ—¥æœŸ |
| mealType | enum | 'BREAKFAST'\|'LUNCH'\|'DINNER' | é¤åˆ¥ |
| unitPrice | number | NOT NULL, >= 0 | å–®åƒ¹ |
| estimatedCount | number | NOT NULL, >= 0 | é ä¼°äººæ•¸ |
| actualCount | number | >= 0 | å¯¦éš›äººæ•¸ |

### 3. å…±ç”¨æ¨¡çµ„ (Shared)

- [x] åŸºç¤å»ºè¨­ (types, config, constants)
- [x] å„²å­˜å±¤å°è£ (CRUD æ“ä½œ)
- [ ] é€šç”¨ UI å…ƒä»¶

### 4. ç¨ç«‹æ¨¡çµ„ (Modules)

#### æ¨¡çµ„ï¼špricing (è¨ˆåƒ¹å¼•æ“)
- ä¾è³´: [shared/types, shared/storage]
- å…¬é–‹ API (index.ts):
  - calcWeeklyEstimate(planId: string): Promise<number>
  - calcWeeklyActual(planId: string): Promise<number>
  - getVarianceReport(planId: string): Promise<VarianceReport>
- ç¨ç«‹åŠŸèƒ½:
  - [x] åŸºç¤è¨ˆåƒ¹ (å›ºå®šå–®åƒ¹ Ã— äººæ•¸)
  - [ ] å½ˆæ€§å–®åƒ¹è¨ˆåƒ¹
  - [ ] æ—¥æœŸå½ˆæ€§è¨ˆåƒ¹
  - [ ] é¤åˆ¥å½ˆæ€§è¨ˆåƒ¹
  - [ ] é ä¼°vså¯¦éš›å·®ç•°

#### æ¨¡çµ„ï¼šmeal-plan (é¤åˆ¥ç®¡ç†)
- ä¾è³´: [shared/types, shared/storage]
- å…¬é–‹ API (index.ts):
  - createPlan(vendorId: string, weekOf: string): Promise<MealPlan>
  - addMealItem(planId: string, item: MealItemInput): Promise<MealItem>
  - getPlan(planId: string): Promise<MealPlan>
- ç¨ç«‹åŠŸèƒ½:
  - [x] å»ºç«‹é€±è¨ˆç•«
  - [x] æ–°å¢é¤åˆ¥é …ç›®
  - [ ] æ‰¹æ¬¡è¨­å®š

### 5. è·¯ç”±çµæ§‹

```
src/
â”œâ”€â”€ config/
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ types/
â”‚   â””â”€â”€ storage/
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ pricing/
â”‚   â””â”€â”€ meal-plan/
â””â”€â”€ index.ts
```

---

## ğŸ”„ è®Šç•°é»åˆ†æ (Variation Points)

### åè©åˆ†æ

| åè© | å›ºå®š/å¯è®Š | èªªæ˜ |
|------|----------|------|
| å» å•† | [å›ºå®š] | å°å£å» å•†ï¼Œé€±è¨ˆç•«ç¶å®š |
| è¨ˆåƒ¹é€±æœŸ | [å›ºå®š] | ä»¥é€±ç‚ºå–®ä½çµç®— |
| å–®åƒ¹ | [å¯è®Š] | ä¸åŒé¤åˆ¥å¯èƒ½ä¸åŒåƒ¹ |
| ä¾›é¤æ—¥æœŸ | [å¯è®Š] | æ¯é€±ä¾›é¤å¤©æ•¸å¯èª¿ (1-4 æˆ– 1-5) |
| é¤åˆ¥ | [å¯è®Š] | æ¯å¤©ä¾›é¤ç¨®é¡å¯èª¿ |
| äººæ•¸ | [å¯è®Š] | é ä¼°ç™»è¨˜ vs å¯¦éš›ç”¨é¤ |

### åˆ†å±¤å®šç¾©

| å±¤ | åç¨± | æ–°å¢ç¶­åº¦ | API è®ŠåŒ– | å°æ‡‰ Iter |
|----|------|---------|---------|----------|
| BASE | å›ºå®šè¨ˆåƒ¹ | ç„¡ (å…¨å›ºå®š) | calcWeekly(planId) â†’ number | 1 |
| L1 | å–®åƒ¹å½ˆæ€§ | å–®åƒ¹å¯è®Š | calcWeekly(planId, priceTable?) â†’ number | 2 |
| L2 | æ—¥æœŸå½ˆæ€§ | æ—¥æœŸå¯è®Š | + setServingDays(planId, days[]) | 2 |
| L3 | é¤åˆ¥å½ˆæ€§ | é¤åˆ¥å¯è®Š | + setMealSchedule(planId, schedule) | 3 |
| L4 | é ä¼°vså¯¦éš› | äººæ•¸å¯è®Š | + recordActual() + getVariance() | 3 |

### ç¢ºèªç‹€æ…‹

- [x] BASE: å›ºå®šè¨ˆåƒ¹ â€” iter-1 å¯¦ä½œ
- [x] L1: å–®åƒ¹å½ˆæ€§ â€” iter-2 å¯¦ä½œ
- [x] L2: æ—¥æœŸå½ˆæ€§ â€” iter-2 å¯¦ä½œ
- [ ] L3: é¤åˆ¥å½ˆæ€§ â€” è¨ˆç•« iter-3
- [ ] L4: é ä¼°vså¯¦éš› â€” è¨ˆç•« iter-3

---

## ğŸ“… è¿­ä»£è¦åŠƒè¡¨ (Iteration Planning)

| Iter | ç¯„åœ | ç›®æ¨™ | æ¨¡çµ„ | äº¤ä»˜ | ä¾è³´ | ç‹€æ…‹ |
|------|------|------|------|------|------|------|
| 1 | Foundation | å‹åˆ¥ + å„²å­˜ + åŸºç¤è¨ˆåƒ¹ | shared | INFRA | ç„¡ | [CURRENT] |
| 2 | Flex Pricing | å–®åƒ¹å½ˆæ€§ + æ—¥æœŸå½ˆæ€§ | pricing | FULL | shared | [STUB] |
| 3 | Full Flex | é¤åˆ¥å½ˆæ€§ + é ä¼°vså¯¦éš› | meal-plan | FULL | shared, pricing | [STUB] |

---

## ğŸ“‹ æ¨¡çµ„å‹•ä½œæ¸…å–® (Module Actions)

### Iter 1: shared [CURRENT]

| æ¥­å‹™èªæ„ | é¡å‹ | æŠ€è¡“åç¨± | P | æµå‘ | ä¾è³´ | ç‹€æ…‹ | æ¼”åŒ– |
|---------|------|---------|---|------|------|------|------|
| æ ¸å¿ƒå‹åˆ¥å®šç¾© | CONST | CoreTypes | P0 | DEFINEâ†’FREEZEâ†’EXPORT | ç„¡ | â—‹â—‹ | BASE |
| å„²å­˜å±¤å°è£ | LIB | storage | P1 | INITâ†’CRUD_OPSâ†’EXPORT | [Internal.CoreTypes] | â—‹â—‹ | BASE |
| åŸºç¤è¨ˆåƒ¹é‚è¼¯ | SVC | calcWeekly | P0 | LOAD_PLANâ†’SUM_ITEMSâ†’RETURN | [Internal.CoreTypes, Internal.storage] | â—‹â—‹ | BASE |
| é€±è¨ˆç•«ç®¡ç† | SVC | planService | P1 | VALIDATEâ†’CREATEâ†’PERSISTâ†’RETURN | [Internal.CoreTypes, Internal.storage] | â—‹â—‹ | BASE |

### Iter 2: pricing [STUB]

> å–®åƒ¹å½ˆæ€§ + æ—¥æœŸå½ˆæ€§è¨ˆåƒ¹ï¼Œä¾è³´ shared
> é ä¼°: 4 å€‹å‹•ä½œ (1Ã—P0, 2Ã—P1, 1Ã—P2)
> å…¬é–‹ API: calcWeeklyEstimate, setServingDays

### Iter 3: meal-plan [STUB]

> é¤åˆ¥å½ˆæ€§ + é ä¼°vså¯¦éš›å·®ç•°ï¼Œä¾è³´ shared + pricing
> é ä¼°: 4 å€‹å‹•ä½œ (1Ã—P0, 2Ã—P1, 1Ã—P2)
> å…¬é–‹ API: setMealSchedule, recordActual, getVarianceReport

---

## åŠŸèƒ½æ¨¡çµ„æ¸…å–®

- [x] åŸºç¤å»ºè¨­ (types, storage)
- [x] åŸºç¤è¨ˆåƒ¹ (å›ºå®šå–®åƒ¹)
- [x] é€±è¨ˆç•«ç®¡ç†
- [ ] å½ˆæ€§è¨ˆåƒ¹ (å–®åƒ¹ + æ—¥æœŸ)
- [ ] é¤åˆ¥å½ˆæ€§
- [ ] é ä¼°vså¯¦éš›

### ä¸åšä»€éº¼

- ä¸åšå“¡å·¥ç™»å…¥ç³»çµ±
- ä¸åšå» å•†ç«¯ä»‹é¢
- ä¸åšå¤šå…¬å¸ç®¡ç†

---

## é‡æ¸…é …ç›®

### ä½¿ç”¨è€…è§’è‰²
- [x] ä¸»è¦ä½¿ç”¨è€…ï¼šè¡Œæ”¿äººå“¡ (è¨­å®šèœå–®å’Œåƒ¹æ ¼)
- [x] æ¬¡è¦ä½¿ç”¨è€…ï¼šè²¡å‹™äººå“¡ (æŸ¥çœ‹å ±è¡¨)

### æ ¸å¿ƒç›®æ¨™
- [x] è§£æ±ºå•é¡Œï¼šæ‰‹å‹• Excel è¨ˆåƒ¹å®¹æ˜“å‡ºéŒ¯
- [x] é æœŸæ•ˆç›Šï¼šè‡ªå‹•è¨ˆç®—ï¼Œæ¸›å°‘äººå·¥éŒ¯èª¤

### è³‡æ–™çµæ§‹
- [x] æ ¸å¿ƒå¯¦é«”ï¼šVendor, MealPlan, MealItem

### é‚Šç•Œæ¢ä»¶
- [x] è³‡æ–™é‡é™åˆ¶ï¼šå–®å…¬å¸æ¯é€±æœ€å¤š 50 ç­†é¤åˆ¥é …ç›®
- [x] åŒæ™‚æ“ä½œï¼šå–®ä¸€è¡Œæ”¿äººå“¡æ“ä½œ

---

## POC é©—è­‰æ¨¡å¼

**Level**: M

---

**è—åœ–ç‹€æ…‹**: [~] ACTIVE
