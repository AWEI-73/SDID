<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blueprint Spec Generator - POC</title>
<!--
  @GEMS-VERIFIED: (Ê≠§ POC È©óË≠âÁöÑÂäüËÉΩ)
  - [x] MMAP YAML Ëß£ÊûêËàáÈ°ØÁ§∫
  - [x] Iter ÂàáÊèõÂ∞éË¶Ω
  - [x] Module ÂÅ¥ÈÇäÈÅ∏ÊìáÂô®
  - [x] Action Ë™ûÊÑèË°®Ê†º (biz/type/tech/flow/deps/remark)
  - [x] JSON ÂåØÂÖ•/ÂåØÂá∫
  - [x] Âæû requirement_spec ÂèçÂêëËß£Êûê
  - [ ] Ëàá blueprint-runner.cjs Êï¥Âêà (Êú™ÂØ¶‰Ωú)
  - [ ] Ëá™ÂãïÁî¢Áîü mmap.yaml (Êú™ÂØ¶‰Ωú)

  @GEMS-DESIGN-BRIEF:
  Tone: Â∑•Á®ãÂ∏´Â∑•ÂÖ∑È¢®Ê†ºÔºåÊ∑±Ëâ≤‰∏ªÈ°å
  Palette: Slate-900 Â∫ïËâ≤, Indigo Âº∑Ë™ø, Emerald ÊàêÂäü
  Typography: System UI + Monospace Ê∑∑Êê≠
  Signature: Â∑¶ÂÅ¥Ê®°ÁµÑÁÄèË¶Ω + Âè≥ÂÅ¥Ë™ûÊÑèË°®Ê†º
-->
<style>
  :root {
    --bg: #0f172a; --surface: #1e293b; --border: #334155;
    --text: #e2e8f0; --dim: #94a3b8; --accent: #818cf8;
    --accent-bg: #312e81; --success: #34d399; --warn: #fbbf24;
    --type-api: #a78bfa; --type-svc: #60a5fa; --type-hook: #fbbf24;
    --type-ui: #f472b6; --type-const: #94a3b8; --type-lib: #2dd4bf;
    --type-route: #fb923c; --type-script: #a3e635;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

  /* Top Bar */
  .topbar { display:flex; align-items:stretch; border-bottom: 1px solid var(--border); background: var(--surface); }
  .brand { background: #0f172a; padding: 12px 20px; display:flex; align-items:center; gap:10px; border-right: 1px solid var(--border); min-width: 200px; }
  .brand-icon { width:32px; height:32px; background: var(--accent); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:16px; }
  .brand-text { display:flex; flex-direction:column; }
  .brand-title { font-size:13px; font-weight:900; letter-spacing:1px; text-transform:uppercase; }
  .brand-sub { font-size:9px; font-weight:700; color:var(--accent); text-transform:uppercase; letter-spacing:2px; margin-top:2px; }

  /* Iter Tabs */
  .iter-tabs { display:flex; flex:1; overflow-x:auto; }
  .iter-tab { flex:1; min-width:130px; padding:12px 16px; display:flex; flex-direction:column; align-items:center; cursor:pointer; border:none; background:transparent; color:var(--dim); transition:all .2s; position:relative; }
  .iter-tab:hover { background: rgba(99,102,241,.05); color:var(--text); }
  .iter-tab.active { background: rgba(99,102,241,.08); color:var(--accent); }
  .iter-tab.active::after { content:''; position:absolute; bottom:0; left:0; right:0; height:3px; background:var(--accent); }
  .iter-num { width:22px; height:22px; border-radius:50%; border:2px solid var(--border); display:flex; align-items:center; justify-content:center; font-size:10px; font-weight:900; margin-bottom:4px; }
  .iter-tab.active .iter-num { background:var(--accent); border-color:var(--accent); color:#fff; }
  .iter-label { font-size:9px; font-weight:800; text-transform:uppercase; letter-spacing:1.5px; }
  .iter-title { font-size:8px; font-weight:700; margin-top:2px; opacity:.6; max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

  /* Actions Bar */
  .actions-bar { display:flex; align-items:center; gap:8px; padding:8px 16px; border-right:1px solid var(--border); background:#0f172a; }
  .action-btn { padding:6px 12px; border:1px solid var(--border); border-radius:8px; background:transparent; color:var(--dim); font-size:10px; font-weight:700; cursor:pointer; transition:all .15s; text-transform:uppercase; letter-spacing:.5px; }
  .action-btn:hover { border-color:var(--accent); color:var(--accent); background:rgba(99,102,241,.08); }
  .action-btn.primary { background:var(--accent); border-color:var(--accent); color:#fff; }
  .action-btn.primary:hover { background:#6366f1; }

  /* Main Layout */
  .main { display:grid; grid-template-columns: 220px 1fr; min-height: calc(100vh - 56px); }

  /* Sidebar */
  .sidebar { border-right:1px solid var(--border); padding:16px 12px; display:flex; flex-direction:column; gap:8px; background:var(--surface); }
  .sidebar-label { font-size:9px; font-weight:900; color:var(--dim); text-transform:uppercase; letter-spacing:2px; padding:0 8px; margin-bottom:4px; }
  .mod-btn { width:100%; text-align:left; padding:10px 12px; border-radius:12px; border:1px solid transparent; background:transparent; color:var(--dim); cursor:pointer; transition:all .15s; display:flex; align-items:center; gap:8px; }
  .mod-btn:hover { border-color:var(--border); background:rgba(255,255,255,.02); color:var(--text); }
  .mod-btn.active { background:var(--accent); border-color:var(--accent); color:#fff; box-shadow: 0 4px 12px rgba(99,102,241,.3); }
  .mod-icon { font-size:12px; opacity:.6; }
  .mod-btn.active .mod-icon { opacity:1; }
  .mod-name { font-size:10px; font-weight:800; text-transform:uppercase; letter-spacing:.3px; line-height:1.3; }
  .sidebar-summary { margin-top:auto; padding:12px; background:rgba(99,102,241,.08); border-radius:12px; border:1px solid rgba(99,102,241,.15); }
  .sidebar-summary h4 { font-size:9px; font-weight:900; color:var(--accent); text-transform:uppercase; letter-spacing:1.5px; margin-bottom:6px; }
  .sidebar-summary p { font-size:10px; color:var(--dim); line-height:1.5; font-style:italic; }

  /* Content */
  .content { display:flex; flex-direction:column; }

  /* File Info */
  .file-info { padding:10px 20px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; background:rgba(15,23,42,.5); }
  .file-path { font-family:'Cascadia Code','Fira Code',monospace; font-size:11px; font-weight:700; color:var(--accent); }
  .file-meta { font-size:9px; font-weight:700; color:var(--dim); text-transform:uppercase; letter-spacing:1px; }

  /* Table */
  .spec-table { width:100%; border-collapse:collapse; table-layout:fixed; }
  .spec-table th { padding:12px 20px; font-size:9px; font-weight:900; color:var(--dim); text-transform:uppercase; letter-spacing:1.5px; border-bottom:1px solid var(--border); text-align:left; background:rgba(15,23,42,.3); }
  .spec-table td { padding:14px 20px; border-bottom:1px solid rgba(51,65,85,.3); vertical-align:top; }
  .spec-table tr:hover td { background:rgba(99,102,241,.03); }
  .spec-table th:nth-child(1) { width:18%; }
  .spec-table th:nth-child(2) { width:8%; }
  .spec-table th:nth-child(3) { width:28%; }
  .spec-table th:nth-child(4) { width:16%; }
  .spec-table th:nth-child(5) { width:30%; }

  .biz-name { font-size:12px; font-weight:800; color:var(--text); display:flex; align-items:flex-start; gap:8px; }
  .biz-dot { width:6px; height:6px; border-radius:50%; background:var(--border); margin-top:5px; flex-shrink:0; }
  tr:hover .biz-dot { background:var(--accent); }

  .type-tag { font-size:9px; font-weight:900; padding:2px 8px; border-radius:4px; border:1px solid; display:inline-block; }
  .type-API { background:rgba(167,139,250,.1); color:var(--type-api); border-color:rgba(167,139,250,.2); }
  .type-SVC { background:rgba(96,165,250,.1); color:var(--type-svc); border-color:rgba(96,165,250,.2); }
  .type-HOOK { background:rgba(251,191,36,.1); color:var(--type-hook); border-color:rgba(251,191,36,.2); }
  .type-UI { background:rgba(244,114,182,.1); color:var(--type-ui); border-color:rgba(244,114,182,.2); }
  .type-CONST { background:rgba(148,163,184,.1); color:var(--type-const); border-color:rgba(148,163,184,.2); }
  .type-LIB { background:rgba(45,212,191,.1); color:var(--type-lib); border-color:rgba(45,212,191,.2); }
  .type-ROUTE { background:rgba(251,146,60,.1); color:var(--type-route); border-color:rgba(251,146,60,.2); }
  .type-SCRIPT { background:rgba(163,230,53,.1); color:var(--type-script); border-color:rgba(163,230,53,.2); }

  .tech-name { font-family:monospace; font-size:11px; font-weight:800; color:var(--accent); background:rgba(99,102,241,.08); border:1px solid rgba(99,102,241,.15); padding:2px 8px; border-radius:4px; display:inline-block; margin-bottom:6px; }
  .flow-steps { display:flex; flex-wrap:wrap; align-items:center; gap:4px; }
  .flow-step { font-family:monospace; font-size:9px; font-weight:800; background:#0f172a; color:var(--dim); padding:2px 6px; border-radius:3px; text-transform:uppercase; letter-spacing:.5px; }
  .flow-arrow { color:var(--border); font-size:10px; }

  .dep-tag { display:inline-flex; align-items:center; gap:4px; padding:2px 8px; background:rgba(255,255,255,.03); border:1px solid var(--border); border-radius:6px; margin:2px; font-family:monospace; font-size:8px; font-weight:800; color:var(--dim); text-transform:uppercase; letter-spacing:.5px; }
  .dep-icon { opacity:.4; }

  .remark { font-size:10px; color:var(--dim); line-height:1.6; font-weight:600; }
  tr:hover .remark { color:var(--text); }

  /* Footer */
  .footer { margin-top:auto; padding:10px 20px; background:#0f172a; border-top:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
  .footer-info { font-size:8px; font-weight:800; color:var(--dim); text-transform:uppercase; letter-spacing:2px; display:flex; align-items:center; gap:16px; }
  .footer-badge { font-size:9px; font-weight:800; padding:2px 8px; border-radius:4px; }
  .badge-green { background:rgba(52,211,153,.1); color:var(--success); }
  .badge-blue { background:rgba(99,102,241,.1); color:var(--accent); }

  /* Modal */
  .modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); z-index:100; align-items:center; justify-content:center; }
  .modal-overlay.show { display:flex; }
  .modal { background:var(--surface); border:1px solid var(--border); border-radius:16px; width:90%; max-width:800px; max-height:80vh; overflow:hidden; display:flex; flex-direction:column; }
  .modal-header { padding:16px 20px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
  .modal-title { font-size:13px; font-weight:900; text-transform:uppercase; letter-spacing:1px; }
  .modal-close { background:none; border:none; color:var(--dim); font-size:18px; cursor:pointer; padding:4px 8px; }
  .modal-close:hover { color:var(--text); }
  .modal-body { padding:20px; overflow-y:auto; flex:1; }
  .modal-body textarea { width:100%; min-height:300px; background:#0f172a; border:1px solid var(--border); border-radius:8px; color:var(--text); font-family:monospace; font-size:11px; padding:12px; resize:vertical; }
  .modal-footer { padding:12px 20px; border-top:1px solid var(--border); display:flex; justify-content:flex-end; gap:8px; }

  /* Add Module/Action Forms */
  .add-form { padding:12px; background:rgba(99,102,241,.05); border:1px dashed rgba(99,102,241,.2); border-radius:12px; margin-top:8px; }
  .form-row { display:flex; gap:8px; margin-bottom:8px; align-items:center; }
  .form-input { flex:1; padding:6px 10px; background:#0f172a; border:1px solid var(--border); border-radius:6px; color:var(--text); font-size:11px; font-family:inherit; }
  .form-input:focus { outline:none; border-color:var(--accent); }
  .form-select { padding:6px 10px; background:#0f172a; border:1px solid var(--border); border-radius:6px; color:var(--text); font-size:11px; }
</style>
</head>
<body>

<!-- Top Bar -->
<div class="topbar">
  <div class="brand">
    <div class="brand-icon">üìê</div>
    <div class="brand-text">
      <span class="brand-title">Blueprint Spec</span>
      <span class="brand-sub">Modular Architecture</span>
    </div>
  </div>
  <div class="iter-tabs" id="iterTabs"></div>
  <div class="actions-bar">
    <button class="action-btn" onclick="showImportModal()">üì• Import</button>
    <button class="action-btn" onclick="exportJSON()">üì§ Export</button>
    <button class="action-btn primary" onclick="addIter()">+ Iter</button>
  </div>
</div>

<!-- Main -->
<div class="main">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-label">üß© Slices / Layers</div>
    <div id="moduleList"></div>
    <button class="action-btn" style="width:100%;margin-top:8px;" onclick="addModule()">+ Add Module</button>
    <div class="sidebar-summary" id="iterSummary"></div>
  </div>

  <!-- Content -->
  <div class="content">
    <div class="file-info">
      <div>
        <div style="font-size:8px;font-weight:800;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-bottom:2px;">Target Entry Point</div>
        <div class="file-path" id="filePath">-</div>
      </div>
      <div class="file-meta">Dependency Rules: <span style="color:var(--success)">Strict Inside-Out</span></div>
    </div>

    <div style="flex:1;overflow:auto;">
      <table class="spec-table">
        <thead>
          <tr>
            <th>Ê•≠ÂãôË™ûÊÑè (CN)</th>
            <th>È°ûÂûã</th>
            <th>ÂØ¶‰ΩúËàáÊµÅÂêë (Tech & Flow)</th>
            <th>‰æùË≥¥ (Deps)</th>
            <th>ÈñãÁôºË¶èÂâáÂ∞çÊáâ (Remarks)</th>
          </tr>
        </thead>
        <tbody id="actionTable"></tbody>
      </table>
      <div style="padding:12px 20px;">
        <button class="action-btn" onclick="addAction()">+ Add Action</button>
      </div>
    </div>

    <div class="footer">
      <div class="footer-info">
        <span class="footer-badge badge-green">‚úì MODULAR_V1</span>
        <span class="footer-badge badge-blue">AI_FRIENDLY</span>
        <span>Facade Entry: index.ts</span>
      </div>
      <button class="action-btn primary" onclick="generateYAML()">‚ö° Generate MMAP YAML</button>
    </div>
  </div>
</div>

<!-- Import Modal -->
<div class="modal-overlay" id="importModal">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title">üì• Import Blueprint JSON</span>
      <button class="modal-close" onclick="closeModal('importModal')">&times;</button>
    </div>
    <div class="modal-body">
      <textarea id="importText" placeholder='Ë≤º‰∏ä JSON Ê†ºÂºèÁöÑËóçÂúñÊï∏Êìö...'></textarea>
    </div>
    <div class="modal-footer">
      <button class="action-btn" onclick="closeModal('importModal')">Cancel</button>
      <button class="action-btn primary" onclick="doImport()">Import</button>
    </div>
  </div>
</div>

<!-- YAML Output Modal -->
<div class="modal-overlay" id="yamlModal">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title">‚ö° Generated MMAP YAML</span>
      <button class="modal-close" onclick="closeModal('yamlModal')">&times;</button>
    </div>
    <div class="modal-body">
      <textarea id="yamlOutput" readonly style="min-height:400px;"></textarea>
    </div>
    <div class="modal-footer">
      <button class="action-btn" onclick="copyYAML()">üìã Copy</button>
      <button class="action-btn primary" onclick="closeModal('yamlModal')">Close</button>
    </div>
  </div>
</div>

<script>
// ============================================
// Êï∏ÊìöÊ®°Âûã
// ============================================
let specData = [
  {
    iter: 1, title: "Foundation (Lib & Config)",
    desc: "Â∫ïÂ±§ÈÖçÁΩÆËàáÁ¨¨‰∏âÊñπÂ∫´Â∞ÅË£ù (src/config, src/lib)",
    modules: [
      {
        name: "ÂÖ®ÂüüÈÖçÁΩÆ (Config)", path: "src/config/constants.ts", icon: "‚öôÔ∏è",
        actions: [
          { biz: "Áí∞Â¢ÉËÆäÊï∏ÁÆ°ÁêÜ", type: "CONST", tech: "ENV_CONFIG", flow: "LOAD_ENV ‚Üí VALIDATE ‚Üí EXPORT", deps: "NONE", remark: "ÂÆöÁæ© API_URL, TIMEOUT Á≠â‰∏çÂèØËÆäÂ∏∏Êï∏„ÄÇ‰∏ç‰æùË≥¥ÂÖ∂‰ªñÂ±§„ÄÇ" },
          { biz: "Á≥ªÁµ±Ê¨äÈôêÂÆöÁæ©", type: "CONST", tech: "AUTH_ROLES", flow: "DEFINE ‚Üí FREEZE ‚Üí EXPORT", deps: "NONE", remark: "ÂÆöÁæ© ADMIN, USER Á≠âÊ¨äÈôêÂ≠ó‰∏≤Ôºå‰æõÂÖ®Âüü‰ΩøÁî®„ÄÇ" }
        ]
      },
      {
        name: "Ê†∏ÂøÉÂ∫´Â∞ÅË£ù (Lib)", path: "src/lib/axios.ts", icon: "üîß",
        actions: [
          { biz: "HTTP ÂÆ¢Êà∂Á´ØÂ∞ÅË£ù", type: "LIB", tech: "apiClient", flow: "CREATE_INST ‚Üí ADD_INTERCEPTORS ‚Üí EXPORT", deps: "src/config", remark: "Â∞ÅÈéñÂ∫ïÂ±§ÂÇ≥Ëº∏ÈÇèËºØÔºåËôïÁêÜÂÖ®Âüü 401/500 ÈåØË™§ÊîîÊà™„ÄÇ" },
          { biz: "Êó•ÊúüÈÅãÁÆóÂ∑•ÂÖ∑", type: "LIB", tech: "dateUtils", flow: "WRAPPING_DAYJS ‚Üí FORMAT ‚Üí EXPORT", deps: "NONE", remark: "Á¨¨‰∏âÊñπÊó•ÊúüÂ∫´ÁöÑËñÑÂ∞ÅË£ùÔºåÊñπ‰æøÊú™‰æÜÊõøÊèõÂ∫´ËÄå‰∏çÂΩ±ÈüøÊ•≠ÂãôÂ±§„ÄÇ" }
        ]
      }
    ]
  },
  {
    iter: 2, title: "Shared Layers",
    desc: "Ë∑®Ê®°ÁµÑÂÖ±Áî®ÈÇèËºØËàá‰ΩàÂ±Ä (src/shared)",
    modules: [
      {
        name: "ÂÖ®Âüü‰ΩàÂ±Ä (Layouts)", path: "src/shared/layouts/MainLayout.tsx", icon: "üìê",
        actions: [
          { biz: "‰∏ªÈ†ÅÈù¢‰ΩàÂ±ÄÊßãÂª∫", type: "UI", tech: "MainLayout", flow: "RENDER_NAV ‚Üí RENDER_CONTENT ‚Üí RENDER_FOOTER", deps: "src/shared/components", remark: "ÂÆöÁæ©Á≥ªÁµ±Ê®ôÊ∫ñÁöÑ‰∏ä‰∏ãÁµêÊßãÔºåÂÖßÂÆπÂçÄÂ°ä‰ΩøÁî® Slot/Children Ê≥®ÂÖ•„ÄÇ" },
          { biz: "Â∞éËà™Âàó", type: "UI", tech: "NavigationBar", flow: "FETCH_ROUTES ‚Üí MAP_LINKS ‚Üí RENDER", deps: "src/routes", remark: "ÂÖ±Áî®Â∞éËà™ÂÖÉ‰ª∂ÔºåÊ†πÊìöÁî®Êà∂ËßíËâ≤È°ØÁ§∫Â∞çÊáâË∑ØÂæë„ÄÇ" }
        ]
      },
      {
        name: "ÂÖ±Áî®ÈÇèËºØ (Shared Hooks)", path: "src/shared/hooks/useToast.ts", icon: "üîó",
        actions: [
          { biz: "ÂÖ®ÂüüÈÄöÁü•Ë™øÁî®", type: "HOOK", tech: "useToast", flow: "STATE_OPEN ‚Üí AUTO_HIDE ‚Üí CLEANUP", deps: "src/shared/store", remark: "R3: Hooks ÂÑ™ÂÖà„ÄÇËÆì UI ÂÖÉ‰ª∂Âè™ÈúÄË™øÁî®ÂáΩÊï∏Âç≥ÂèØÈ°ØÁ§∫ÈÄöÁü•„ÄÇ" }
        ]
      }
    ]
  },
  {
    iter: 3, title: "Auth Module (Vertical Slice)",
    desc: "Ë∫´ÂàÜÈ©óË≠âÂûÇÁõ¥ÂàÜÁâá (src/modules/auth)",
    modules: [
      {
        name: "Ë∫´ÂàÜÈ©óË≠âÊ†∏ÂøÉ", path: "src/modules/auth/index.ts", icon: "üõ°Ô∏è",
        actions: [
          { biz: "ÁôªÂÖ• API ‰∏≤Êé•", type: "API", tech: "api.login", flow: "POST_REQ ‚Üí RECV_DTO ‚Üí HANDLE_ERR", deps: "src/lib/axios", remark: "R1: API Ëàá Service ÂàÜÈõ¢„ÄÇÂÉÖË≤†Ë≤¨ HTTP Ë´ãÊ±ÇËàá DTO Êé•Êî∂„ÄÇ" },
          { biz: "Áî®Êà∂Ë≥áÊñôÊ¥óÊ∏Ö", type: "SVC", tech: "userService.format", flow: "RECV_DTO ‚Üí MAP_TO_MODEL ‚Üí EXPORT", deps: "src/modules/auth/types", remark: "R4: DTO vs Model„ÄÇÂ∞áÂæåÁ´Ø snake_case ËΩâÊèõÁÇ∫ÂâçÁ´Ø camelCase„ÄÇ" },
          { biz: "ÁôªÂÖ•ÈÇèËºØ Hooks", type: "HOOK", tech: "useLogin", flow: "CALL_API ‚Üí CONVERT_DATA ‚Üí SET_STORE", deps: "api, services, store", remark: "R3: Hooks ÂÑ™ÂÖà„ÄÇÂ∞ÅË£ù UI ‰∫íÂãïËàáÊ•≠ÂãôÈÇèËºØÔºåÂÖÉ‰ª∂ÂÉÖË≤†Ë≤¨Ê∏≤Êüì„ÄÇ" }
        ]
      }
    ]
  },
  {
    iter: 4, title: "Business Module",
    desc: "Ê†∏ÂøÉÊ•≠ÂãôÂûÇÁõ¥ÂàÜÁâá (src/modules/meal-management)",
    modules: [
      {
        name: "È§êÈªûÁÆ°ÁêÜÊ®°ÁµÑ", path: "src/modules/meal/index.ts", icon: "üìã",
        actions: [
          { biz: "ËèúÂñÆÂàóË°®Áç≤Âèñ", type: "API", tech: "api.getMenuList", flow: "FETCH ‚Üí RETRY_LOGIC ‚Üí DTO", deps: "src/lib/axios", remark: "R1: Âè™ËôïÁêÜË´ãÊ±Ç„ÄÇ‰ΩøÁî® DTO ‰ªãÈù¢‰øùË≠∑ÂÖßÈÉ®‰ª£Á¢º„ÄÇ" },
          { biz: "ÁáüÈ§äÊàêÂàÜË®àÁÆó", type: "SVC", tech: "calcNutrition", flow: "INPUT_INGREDIENTS ‚Üí FORMULA ‚Üí SUMMARY", deps: "NONE", remark: "R1: Á¥îÊ•≠ÂãôÈÇèËºØË®àÁÆóÔºå‰∏çÊ∂âÂèä UI ÁãÄÊÖãÔºåÊñπ‰æøÂñÆÂÖÉÊ∏¨Ë©¶„ÄÇ" },
          { biz: "ËèúÂñÆ‰∫íÂãï Hook", type: "HOOK", tech: "useMenuSelection", flow: "SELECT_ITEM ‚Üí UPDATE_CART ‚Üí SYNC", deps: "api, services", remark: "R3: Èö±ËóèË§áÈõúÁöÑÈÅ∏ÊìáÈÇèËºØÔºåÂ∞çÂ§ñÊö¥Èú≤Á∞°ÂñÆÁöÑ toggle ‰ªãÈù¢„ÄÇ" }
        ]
      }
    ]
  },
  {
    iter: 5, title: "Routing & Ops",
    desc: "Ë∑ØÁî±Â∞éËà™ËàáËá™ÂãïÂåñÈÉ®ÁΩ≤ (src/routes, scripts)",
    modules: [
      {
        name: "Ë∑ØÁî±ÂÆöÁæ©", path: "src/routes/index.tsx", icon: "üß≠",
        actions: [
          { biz: "ÂãïÊÖãË∑ØÁî±ÈÖçÁΩÆ", type: "ROUTE", tech: "AppRouter", flow: "CHECK_AUTH ‚Üí LAZY_LOAD ‚Üí RENDER", deps: "src/modules", remark: "‰æùË≥¥ÂêÑÊ®°ÁµÑÊö¥Èú≤ÁöÑ PagesÔºåÂØ¶ÁèæÁ®ãÂºèÁ¢ºÂàÜÂâ≤ (Code Splitting)„ÄÇ" }
        ]
      },
      {
        name: "ÈÉ®ÁΩ≤ËÖ≥Êú¨", path: "scripts/deploy.sh", icon: "üñ•Ô∏è",
        actions: [
          { biz: "ÁîüÁî¢Áí∞Â¢ÉÂª∫ÁΩÆ", type: "SCRIPT", tech: "build", flow: "LINT ‚Üí TEST ‚Üí COMPILE", deps: "NONE", remark: "ÈÉ®ÁΩ≤ÂâçÁöÑËá™ÂãïÂåñÊ™¢Ê†∏ÔºåÁ¢∫‰øù‰ª£Á¢ºÁ¨¶Âêà Lint Ë¶èÁØÑËàáÊ∏¨Ë©¶ÈÄöÈÅé„ÄÇ" }
        ]
      }
    ]
  }
];

let activeIter = 1;
let selectedModIdx = 0;

// ============================================
// Ê∏≤Êüì
// ============================================
function render() {
  renderIterTabs();
  renderModules();
  renderTable();
  renderSummary();
}

function renderIterTabs() {
  const el = document.getElementById('iterTabs');
  el.innerHTML = specData.map(it => `
    <button class="iter-tab ${it.iter === activeIter ? 'active' : ''}" onclick="selectIter(${it.iter})">
      <div class="iter-num">${it.iter}</div>
      <span class="iter-label">Iter 0${it.iter}</span>
      <span class="iter-title">${it.title}</span>
    </button>
  `).join('');
}

function renderModules() {
  const iterData = specData.find(i => i.iter === activeIter);
  if (!iterData) return;
  const el = document.getElementById('moduleList');
  el.innerHTML = iterData.modules.map((mod, idx) => `
    <button class="mod-btn ${idx === selectedModIdx ? 'active' : ''}" onclick="selectModule(${idx})">
      <span class="mod-icon">${mod.icon}</span>
      <span class="mod-name">${mod.name}</span>
    </button>
  `).join('');
}

function renderTable() {
  const iterData = specData.find(i => i.iter === activeIter);
  if (!iterData || !iterData.modules[selectedModIdx]) return;
  const mod = iterData.modules[selectedModIdx];

  document.getElementById('filePath').textContent = mod.path;

  const el = document.getElementById('actionTable');
  el.innerHTML = mod.actions.map((act, idx) => `
    <tr>
      <td><div class="biz-name"><span class="biz-dot"></span>${act.biz}</div></td>
      <td><span class="type-tag type-${act.type}">${act.type}</span></td>
      <td>
        <div class="tech-name">${act.tech}</div>
        <div class="flow-steps">
          ${act.flow.split(' ‚Üí ').map((s, i, arr) =>
            `<span class="flow-step">${s}</span>${i < arr.length - 1 ? '<span class="flow-arrow">‚Ä∫</span>' : ''}`
          ).join('')}
        </div>
      </td>
      <td>
        ${act.deps.split(', ').map(d => `<span class="dep-tag"><span class="dep-icon">üîó</span>${d}</span>`).join('')}
      </td>
      <td><div class="remark">${act.remark}</div></td>
    </tr>
  `).join('');
}

function renderSummary() {
  const iterData = specData.find(i => i.iter === activeIter);
  if (!iterData) return;
  document.getElementById('iterSummary').innerHTML = `
    <h4>Iter Summary</h4>
    <p>${iterData.desc}</p>
  `;
}

// ============================================
// ‰∫íÂãï
// ============================================
function selectIter(num) {
  activeIter = num;
  selectedModIdx = 0;
  render();
}

function selectModule(idx) {
  selectedModIdx = idx;
  renderModules();
  renderTable();
}

function addIter() {
  const nextNum = specData.length + 1;
  specData.push({
    iter: nextNum,
    title: `New Iteration ${nextNum}`,
    desc: "Êñ∞Ëø≠‰ª£ÊèèËø∞",
    modules: [{ name: "Êñ∞Ê®°ÁµÑ", path: "src/modules/new/index.ts", icon: "üì¶", actions: [] }]
  });
  activeIter = nextNum;
  selectedModIdx = 0;
  render();
}

function addModule() {
  const iterData = specData.find(i => i.iter === activeIter);
  if (!iterData) return;
  const name = prompt('Ê®°ÁµÑÂêçÁ®±:');
  if (!name) return;
  const path = prompt('Ê™îÊ°àË∑ØÂæë:', 'src/modules/new/index.ts');
  iterData.modules.push({ name, path: path || 'src/new.ts', icon: 'üì¶', actions: [] });
  selectedModIdx = iterData.modules.length - 1;
  render();
}

function addAction() {
  const iterData = specData.find(i => i.iter === activeIter);
  if (!iterData || !iterData.modules[selectedModIdx]) return;
  const mod = iterData.modules[selectedModIdx];
  mod.actions.push({
    biz: "Êñ∞Ê•≠ÂãôÂãï‰Ωú",
    type: "SVC",
    tech: "newFunction",
    flow: "INPUT ‚Üí PROCESS ‚Üí OUTPUT",
    deps: "NONE",
    remark: "ÂæÖÂ°´ÂØ´ÈñãÁôºË¶èÂâáÂ∞çÊáâ"
  });
  renderTable();
}

// ============================================
// Import / Export
// ============================================
function showImportModal() {
  document.getElementById('importModal').classList.add('show');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('show');
}

function doImport() {
  try {
    const text = document.getElementById('importText').value;
    const data = JSON.parse(text);
    if (Array.isArray(data)) {
      specData = data;
      activeIter = specData[0]?.iter || 1;
      selectedModIdx = 0;
      render();
      closeModal('importModal');
      alert('ÂåØÂÖ•ÊàêÂäüÔºÅ');
    } else {
      alert('Ê†ºÂºèÈåØË™§ÔºöÈúÄË¶Å JSON Èô£Âàó');
    }
  } catch (e) {
    alert('JSON Ëß£ÊûêÂ§±Êïó: ' + e.message);
  }
}

function exportJSON() {
  const json = JSON.stringify(specData, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'blueprint-spec.json';
  a.click();
  URL.revokeObjectURL(url);
}

// ============================================
// Generate MMAP YAML
// ============================================
function generateYAML() {
  let yaml = '# Blueprint MMAP - Auto Generated\n';
  yaml += `# Generated: ${new Date().toISOString()}\n\n`;
  yaml += 'project:\n';
  yaml += `  name: "modular-app"\n`;
  yaml += `  version: "1.0"\n\n`;
  yaml += 'iterations:\n';

  for (const iter of specData) {
    yaml += `\n  iter-${iter.iter}:\n`;
    yaml += `    title: "${iter.title}"\n`;
    yaml += `    desc: "${iter.desc}"\n`;
    yaml += `    modules:\n`;

    for (const mod of iter.modules) {
      const modId = mod.name.replace(/[^a-zA-Z0-9]/g, '_').toLowerCase();
      yaml += `\n      ${modId}:\n`;
      yaml += `        name: "${mod.name}"\n`;
      yaml += `        path: "${mod.path}"\n`;
      yaml += `        deps: [${getDepsForModule(mod)}]\n`;
      yaml += `        gems:\n`;

      for (const act of mod.actions) {
        yaml += `          - name: "${act.tech}"\n`;
        yaml += `            biz: "${act.biz}"\n`;
        yaml += `            type: "${act.type}"\n`;
        yaml += `            flow: "${act.flow}"\n`;
        yaml += `            deps: "${act.deps}"\n`;
        yaml += `            remark: "${act.remark}"\n`;
      }
    }
  }

  document.getElementById('yamlOutput').value = yaml;
  document.getElementById('yamlModal').classList.add('show');
}

function getDepsForModule(mod) {
  const allDeps = new Set();
  mod.actions.forEach(a => {
    a.deps.split(', ').forEach(d => {
      if (d !== 'NONE') allDeps.add(`"${d}"`);
    });
  });
  return Array.from(allDeps).join(', ');
}

function copyYAML() {
  const text = document.getElementById('yamlOutput').value;
  navigator.clipboard.writeText(text).then(() => alert('Â∑≤Ë§áË£ΩÔºÅ'));
}

// ============================================
// Init
// ============================================
render();
</script>
</body>
</html>
